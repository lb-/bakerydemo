<style>
    .collapsible .title-wrapper {
        box-sizing: border-box;
        cursor: pointer;
        height: 40px;
        background: #fcf2f2;
        color: #200200;
        padding: .9em 0 .9em 5em;
        font-size: .95em;
        margin: 0;
        line-height: 1.5em;
        font-weight: 400;
    }

    .collapsible .content {
        padding: 0 3rem;
    }

    .collapsible p {
        padding-top: 1rem;
    }

    .collapsible.collapsed .content {
        display: none;
    }

    .collapsible .title-wrapper::before {
        content: "▼";
    }

    .collapsible.collapsed .title-wrapper::before {
        content: "▲";
    }
</style>
<script type="module">
    import { Application, Controller } from "https://unpkg.com/@hotwired/stimulus/dist/stimulus.js";
    window.Stimulus = Application.start();

    class Hello extends Controller {
      static targets = [ "name" ];

      connect() {
          console.log('stimulus', this.element);
      }
    }

    Stimulus.register("hello", Hello);

    class Hello2 extends Hello {
        static targets = [ ...Hello.targets, 'other' ];

        connect() {
          console.log('stimulus 2', this.element);
      }
    }

    Stimulus.register("hello", Hello2);

    Stimulus.register('keyboard-shortcut', class extends Controller {
        static targets = [ 'element' ];
        static values = { command: { default: '', type: String } };

        connect() {
          // allow for single attribute use or for declaring a separate element
          // could be enhanced to update a 'global' register of keyboard shortcuts
          // best to use something like key-js or mousetrap if we actually do this
          const target = this.hasElementTarget ? this.elementTarget : this.element;
          this.keyboardListener = (event) => {
              if (event.key === this.commandValue) {
                  this.elementTarget.click(event);
              }
          };
          document.addEventListener('keyup', this.keyboardListener);
        }

        disconnect() {
            document.removeEventListener('keyup', this.keyboardListener);
        }
    });

    Stimulus.register("collapsible", class extends Controller {
      static classes = [ "collapsed" ];
      static targets = [ "content", "title" ];
      static values = { collapsed: { default: false, type: Boolean }};

      connect() {
          // set up variables
          this.contentId = `${this.element.id || 'random-id-generated'}-content`;
          this.collapsedClassDefaulted = this.hasCollapsedClass ? this.collapsedClass: 'collapsed';

          // set up aria attributes
          this.element.setAttribute('aria-expanded', !this.collapsedValue);
          this.contentTarget.setAttribute('id', this.contentId);
          this.titleTarget.setAttribute('aria-controls', `#${this.contentId}`);
      }

      onAnimationComplete() {
          // 
      }

      collapsedValueChanged() {
          console.log('collapsed value changed');
      }

      toggle(event) {
        const collapsedClass = this.collapsedClassDefaulted;

        // toggle attributes
        this.collapsedValue = !this.collapsedValue;
        this.element.setAttribute('aria-expanded', !this.collapsedValue);

        // animations
        !this.collapsedValue && this.element.classList.remove(collapsedClass);
        const keyframes = { opacity: this.collapsedValue ? [1, 0] : [0, 1] };
        const animation = this.contentTarget.animate(keyframes, { duration: 500, easing: 'ease-out', fill: 'forwards' });
        animation.onfinish = () => {
            this.collapsedValue && this.element.classList.add(collapsedClass);
            this.onAnimationComplete();
        };
      }
    });
</script>
<section class="panel">
    <div data-controller="hello"><span data-hello-target="other"></span></div>
    <section class="collapsible" data-controller="collapsible keyboard-shortcut" data-collapsible-collapsed-value="false" data-keyboard-shortcut-command-value="o">
        <h2 class="title-wrapper" data-collapsible-target="title" data-action="click->collapsible#toggle" data-keyboard-shortcut-target="element">About Stimulus JS</h2>
        <div class="content" data-collapsible-target="content">
            <p>Stimulus is a JavaScript framework with modest ambitions. It doesn’t seek to take over your entire front-end—in fact, it’s not concerned with rendering HTML at all. Instead, it’s designed to augment your HTML with just enough behavior to make it shine.</p>
        </div>
    </section>
</section>